{# Collections Section Component - Like a React Functional Component #}
{% macro render(section, collections) %}
<section class="collections-section {{section.sectionType}} cs-style">
    <div class="cs-container">
        <h2>{{ section.header or "Collection Items" }}</h2>
        <div class="collections-layout {{ section.sectionType }}">
            {% if section.sectionType == "events" %}
                <!-- Original Split View -->
                <!-- Event Details (Left Side) -->
                <div class="event-details">
                    {% set firstEvent = collections.events[0] %}
                    {% if firstEvent %}
                        <div class="event-details-content" data-event-id="0">
                            <h3 class="event-title">{{ firstEvent.data.title }}</h3>
                            <p class="event-date">{{ firstEvent.data.date | postDateTime }}</p>
                            <div class="event-location">
                                <p>{{ firstEvent.data.location }}</p>
                            </div>
                            {% if firstEvent.data.details %}
                                <div class="event-full-details">
                                    {{ firstEvent.data.details | markdown | safe }}
                                </div>
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="event-details-placeholder">
                            <p>Select an event to view details</p>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Event List (Right Side) -->
                <div class="event-list">
                    {% for item in collections.events %}
                        <div class="event-item {% if loop.index0 == 0 %}active{% endif %}" data-event-index="{{ loop.index0 }}" data-event-date="{{ item.data.date }}">
                            <h4 class="event-item-title">{{ item.data.title }}</h4>
                            <p class="event-item-date">{{ item.data.date | postDateTime }}</p>
                            <div class="event-item-data" style="display: none;">
                                <span class="event-location">{{ item.data.location }}</span>
                                <span class="event-details">{{ item.data.details }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Event Modal for Mobile -->
                <div class="event-modal" id="eventModal">
                    <div class="event-modal-overlay"></div>
                    <div class="event-modal-content">
                        <button class="event-modal-close">&times;</button>
                        <div class="event-modal-body">
                            <h3 class="modal-event-title"></h3>
                            <p class="modal-event-date"></p>
                            <div class="modal-event-location"></div>
                            <div class="modal-event-details"></div>
                        </div>
                    </div>
                </div>
                
            {% elseif section.sectionType == "calendar_view" %}
                <!-- View Toggle Buttons -->
                <span>
                <div class="view-toggle">
                    <button class="view-btn active" data-view="calendar">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"/>
                        </svg>
                        Calendar View
                    </button>
                    <button class="view-btn" data-view="list">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"/>
                        </svg>
                        List View
                    </button>
                </div>
                </span>


                <!-- Calendar View -->
                <div class="events-calendar-view active-view">
                    <div class="calendar-header">
                        <button class="calendar-nav prev-month">‹</button>
                        <h3 class="calendar-month-year"></h3>
                        <button class="calendar-nav next-month">›</button>
                    </div>
                    <div class="calendar-grid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                    
                </div>

                <!-- List View -->
                <div class="events-list-view">
                    {% set sortedEvents = collections.events | sort(attribute='data.date') | reverse %}
                    <div class="event-cards-container">
                        {% for item in sortedEvents %}
                            <div class="event-card {% if loop.index > 5 %}hidden-event{% endif %}" data-event-date="{{ item.data.date }}" data-event-index="{{ loop.index }}">
                                <div class="event-card-date-badge" data-date="{{ item.data.date }}">
                                    <span class="event-day"></span>
                                    <span class="event-month"></span>
                                </div>
                                <div class="event-card-content">
                                    <h3 class="event-card-title">{{ item.data.title }}</h3>
                                    <p class="event-card-datetime">{{ item.data.date | postDateTime }}</p>
                                    <div class="event-card-location">
                                        <p>{{ item.data.location }}</p>
                                    </div>
                                    {% if item.data.details %}
                                        <div class="event-card-details">
                                            {{ item.data.details | markdown | safe }}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                    
                    {% if sortedEvents | length > 5 %}
                        <div class="event-show-more-container">
                            <button class="event-show-more">View More Events</button>
                        </div>
                    {% endif %}
                </div>
                
                <!-- Hidden data for calendar -->
                <div class="events-data" style="display: none;">
                    {% for item in collections.events %}
                        <div class="event-data-item" 
                             data-title="{{ item.data.title }}"
                             data-date="{{ item.data.date }}"
                             data-location="{{ item.data.location }}"
                             data-details="{{ item.data.details | striptags }}">
                        </div>
                    {% endfor %}
                </div>
                <!-- Calendar Modal for Events -->
                <div class="calendar-modal" id="calendarModal">
                    <div class="calendar-modal-overlay"></div>
                    <div class="calendar-modal-content">
                        <button class="calendar-modal-close">&times;</button>
                        <div class="calendar-modal-body">
                            <!-- Content will be dynamically populated by JavaScript -->
                        </div>
                    </div>
                </div>
            
            {% elseif section.sectionType == "staff" %}
                <div class="staff-list">
                    {% for item in collections.staff %}
                        <div class="staff-card">
                            <div class="card-header">
                                <h4 class="staff-name">{{ item.data.name }}</h4>
                                <h5 class="staff-title">{{ item.data.title }}</h5>
                            </div>
                            <img src="{{ item.data.photo }}" alt="{{ item.data.name }}" class="staff-photo">

                            <button class="read-more-btn" data-staff-index="{{ loop.index0 }}">Read More</button>
                            
                            <!-- Hidden data for modal -->
                            <div class="staff-modal-data" style="display: none;">
                                <div class="staff-modal-name">{{ item.data.name }}</div>
                                <div class="staff-modal-title">{{ item.data.title }}</div>
                                <div class="staff-modal-photo">{{ item.data.photo }}</div>
                                <div class="staff-modal-date">{{ item.data.date | postDate }}</div>
                                <div class="staff-modal-bio">{{ item.data.description | markdown | safe }}</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Staff Modal -->
                <div class="staff-modal" id="staffModal">
                    <div class="staff-modal-overlay"></div>
                    <div class="staff-modal-content">
                        <button class="staff-modal-close">&times;</button>
                        <div class="staff-modal-body">
                            <img src="" alt="" class="modal-photo">
                            <h3 class="modal-name"></h3>
                            <h4 class="modal-title"></h4>
                            <p class="modal-date"></p>
                            <div class="modal-bio"></div>
                        </div>
                    </div>
                </div>
            {% elseif section.sectionType == "communications" %}
                {# Sort communications by date, most recent first #}
                {% set sortedCommunications = collections.communications | sort(attribute='data.date') | reverse %}
                <div class="communication-list">
                    {% for item in sortedCommunications %}
                        <div class="communication-item {% if loop.index0 >= 3 %}hidden-comm{% endif %}" data-comm-index="{{ loop.index0 }}">
                            <div class="communication-header">
                                <button class="communication-button"> Click to view info</button>
                                <h4 class="communication-subject">{{ item.data.subject }}</h4>
                                <p class="communication-date">{{ item.data.date | postDate }}</p>
                            </div>
                            <!-- Hidden data for modal -->
                            <div class="communication-modal-data" style="display: none;">
                                <div class="communication-modal-subject">{{ item.data.subject }}</div>
                                <div class="communication-modal-date">{{ item.data.date | postDate }}</div>
                                <div class="communication-modal-body">{{ item.templateContent | safe }}</div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                {% if sortedCommunications.length > 3 %}
                <div class="communication-show-more-container">
                    <button class="communication-show-more" id="showMoreComm">
                        Show More
                    </button>
                </div>
                {% endif %}
                
                <!-- Communication Modal -->
                <div class="communication-modal" id="communicationModal">
                    <div class="communication-modal-overlay"></div>
                    <div class="communication-modal-content">
                        <button class="communication-modal-close">&times;</button>
                        <div class="communication-modal-body-container">
                            <h3 class="modal-comm-subject"></h3>
                            <p class="modal-comm-date"></p>
                            <div class="modal-comm-body"></div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</section>
{% endmacro %}
